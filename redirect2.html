<html>
<head>
    <meta charset="utf-8" />
    <meta name="description" content="LampaStream"/>
    <title>LampaStream</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        .load_pic {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }
        
        .selection-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .selection-button {
            margin: 15px;
            padding: 22px 45px;
            font-size: 27px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            min-width: 300px;
            transition: all 0.3s;
        }
        .selection-button:hover, .selection-button:focus {
            background-color: #45a049;
            transform: scale(1.05);
            outline: 3px solid #ffffff;
        }
        .selection-title {
            color: white;
            margin-bottom: 30px;
            font-size: 36px;
            font-weight: bold;
            text-align: center;
        }
        .selection-button.active {
            background-color: #2E7D32;
            transform: scale(1.1);
            box-shadow: 0 0 15px #ffffff;
        }
    </style>
</head>

<body>
  <img class="load_pic" src="./splash.jpg" alt="Фоновое изображение">
  
  <div class="selection-menu" id="selectionMenu">
      <h2 class="selection-title">Выберите сервер:</h2>
      <button class="selection-button" id="server1">Сервер 1 (185.105.117.217:12160)</button>
      <button class="selection-button" id="server2">Сервер 2 (my.bylampa.online)</button>
      <button class="selection-button" id="server3">Сервер 3 (bylampa.online)</button>
  </div>

  <script>
      // Проверяем поддержку localStorage
      const isLocalStorageSupported = () => {
          try {
              const testKey = 'test';
              localStorage.setItem(testKey, testKey);
              localStorage.removeItem(testKey);
              return true;
          } catch(e) {
              return false;
          }
      };
      
      // Серверы
      const servers = {
          server1: 'http://185.105.117.217:12160/',
          server2: 'http://my.bylampa.online/',
          server3: 'http://bylampa.online/'
      };
      
      // Текущая выбранная кнопка
      let currentSelection = 0;
      const buttons = document.querySelectorAll('.selection-button');
      const selectionMenu = document.getElementById('selectionMenu');
      
      // Функция для выбора сервера
      function selectServer(serverId) {
          const url = servers[serverId];
          if(!url) return;
          
          console.log('Выбран сервер:', url); // Для отладки
          
          if(isLocalStorageSupported()) {
              localStorage.setItem('selectedServer', url);
              localStorage.setItem('isFirstRun', 'false');
          }
          
          // Пробуем два метода перехода
          try {
              window.location.assign(url); // Основной метод
          } catch(e) {
              console.error('Ошибка при переходе:', e);
              window.location.href = url; // Альтернативный метод
          }
      }
      
      // Проверяем, был ли уже выбран сервер
      function checkFirstRun() {
          if(!isLocalStorageSupported()) {
              showMenu();
              return;
          }
          
          const selectedServer = localStorage.getItem('selectedServer');
          const isFirstRun = localStorage.getItem('isFirstRun');
          
          if (isFirstRun === null || isFirstRun === 'true') {
              showMenu();
              localStorage.setItem('isFirstRun', 'false');
          } else if (selectedServer) {
              setTimeout(() => {
                  window.location.href = selectedServer;
              }, 100);
          } else {
              showMenu();
          }
      }
      
      // Инициализация навигации и кликов
      function initNavigation() {
          // Назначаем обработчики кликов
          document.getElementById('server1').addEventListener('click', () => selectServer('server1'));
          document.getElementById('server2').addEventListener('click', () => selectServer('server2'));
          document.getElementById('server3').addEventListener('click', () => selectServer('server3'));
          
          // Устанавливаем фокус на первую кнопку
          if (buttons.length > 0) {
              buttons[0].classList.add('active');
              buttons[0].focus();
          }
          
          // Обработка клавиш
          document.addEventListener('keydown', function(e) {
              switch(e.key) {
                  case 'ArrowUp':
                      navigate(-1);
                      e.preventDefault();
                      break;
                  case 'ArrowDown':
                      navigate(1);
                      e.preventDefault();
                      break;
                  case 'Enter':
                      if(currentSelection >= 0 && currentSelection < buttons.length) {
                          const serverId = buttons[currentSelection].id;
                          selectServer(serverId);
                      }
                      e.preventDefault();
                      break;
                  case 'ArrowRight':
                  case 'ArrowLeft':
                      e.preventDefault();
                      break;
                  case 'End':
                  case 'MediaPlayPause':
                      toggleMenu();
                      e.preventDefault();
                      break;
              }
          });
      }
      
      // Навигация между кнопками
      function navigate(direction) {
          if(currentSelection >= 0) {
              buttons[currentSelection].classList.remove('active');
          }
          
          currentSelection += direction;
          
          // Зацикливание навигации
          if(currentSelection < 0) {
              currentSelection = buttons.length - 1;
          } else if(currentSelection >= buttons.length) {
              currentSelection = 0;
          }
          
          buttons[currentSelection].classList.add('active');
          buttons[currentSelection].focus();
      }
      
      // Показать/скрыть меню
      function toggleMenu() {
          if (selectionMenu.style.display === 'flex') {
              selectionMenu.style.display = 'none';
          } else {
              selectionMenu.style.display = 'flex';
              if (buttons.length > 0) {
                  currentSelection = 0;
                  buttons[currentSelection].classList.add('active');
                  buttons[currentSelection].focus();
              }
          }
      }
      
      // Показать меню
      function showMenu() {
          selectionMenu.style.display = 'flex';
          if (buttons.length > 0) {
              currentSelection = 0;
              buttons[currentSelection].classList.add('active');
              buttons[currentSelection].focus();
          }
      }
      
      // Инициализация при загрузке
      window.onload = function() {
          initNavigation();
          checkFirstRun();
          
          // Автоматическое скрытие меню через 30 секунд, если оно видимо
          setTimeout(function() {
              if (selectionMenu.style.display === 'flex') {
                  selectionMenu.style.display = 'none';
                  // Если сервер не выбран, перенаправляем на сервер по умолчанию
                  if (!isLocalStorageSupported() || !localStorage.getItem('selectedServer')) {
                      setTimeout(() => {
                          window.location.href = servers.server1;
                      }, 100);
                  }
              }
          }, 30000);
      };
  </script>
</body>
</html>